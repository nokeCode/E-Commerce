{% extends "products/base.html" %}
{% load static %}
{% load i18n %}
{% block title %}shop{% endblock title %}shop
{% block style %}
<style>
  /* Variables de couleurs simplifiées */
  :root {
    --beige-bg: #F7F3E9;    /* Arrière-plan beige */
    --cream-btn: #E8E2D1;   /* Boutons crème */
  }

  /* Background beige */
  body {
    background: var(--beige-bg) !important;
  }

  /* Boutons et liens en crème */
  .text-primary {
    color: var(--cream-btn) !important;
    font-weight: 600;
  }

  .text-primary:hover {
    color: #D4C9A8 !important; /* Version plus foncée au survol */
  }
</style>
{% endblock style %}

{% block content %}

<div class="container pb-5" id="shop-container">
    <div class="row g-4">
        {% for category, images in images_by_category.items %}
            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card h-100 shadow-sm border-0">
                    <div class="card-body">
                        <h5 class="card-title fw-semibold text-center mb-3">{{ category.name }}</h5>

                        <div class="row row-cols-2 g-3">
                            {% for img in images|slice:":4" %}  {# max 4 images comme Amazon #}
                                <div class="col text-center">
                                    <div class="border rounded p-2 bg-white hover-shadow-sm" style="transition:0.2s;">
                                        <img src="{{ img.image.url }}" 
                                             alt="{{ img.product.name }}" 
                                             class="img-fluid rounded" 
                                             style="width:100px; height:100px; object-fit:cover;">
                                        <p class="small mt-1 text-truncate">{{ img.product.name }}</p>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="card-footer text-center bg-white border-0">
                        <a href="{% url 'category' category.slug %}" class="text-primary fw-semibold text-decoration-none">
                            Voir plus
                        </a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<script>
    const searchForm = document.querySelector('form[action*="shop"]');

    searchForm.addEventListener('submit', function(e) {
        e.preventDefault();

        const query = this.querySelector('input[name="q"]').value;

        fetch(`/shop/?q=${encodeURIComponent(query)}`, {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(res => res.text())
        .then(html => {
            // Remplacer le shop
            document.getElementById('shop-container').innerHTML = html;

            // Cacher sections marketing
            document.getElementById('popular-section').style.display = 'none';
            document.getElementById('new-section').style.display = 'none';
        });
    });
</script>
{% endblock content %}
